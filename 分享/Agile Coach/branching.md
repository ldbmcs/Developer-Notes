---
marp: true
header: "Branching"
footer: "邓朝胜 2021-06-08"
paginate: true
theme: gaia
class: invert
---

<!-- _class: lead invert -->


# Branching

# 分支

---

# 分支简介

分支就是科幻电影里面的平行宇宙，当你正在努力学习Git的时候，另一个你正在另一个平行宇宙里努力学习SVN。

如果两个平行宇宙互不干扰，那对现在的你也没啥影响。不过，在某个时间点，两个平行宇宙合并了，结果，你既学会了Git又学会了SVN！

![2021-06-06-tsb4IN](https://image.ldbmcs.com/2021-06-06-tsb4IN.jpg)

---

# 为什么需要分支

分支在实际中有什么用呢？假设你准备开发一个新功能，但是需要两周才能完成，第一周你写了50%的代码，如果立刻提交，由于代码还没写完，不完整的代码库会导致别人不能干活了。如果等代码全部写完再一次提交，又存在丢失每天进度的巨大风险。

如果你创建了一个属于自己的分支，别人看不到，还继续在原来的分支上正常工作，而你在自己的分支上干活，想提交就提交，直到开发完毕后，再一次性合并到原来的分支上，这样，既安全，又不影响别人工作。

---

# 使用分支

版本控制系统都有分支管理，创建分支需要需要创建主分支源代码的的副本，但是像Subversion这样集中式的版本控制系统创建和切换分支比蜗牛还慢，简直让人无法忍受，结果分支功能成了摆设，大家都不去用。

Git 分支是指针指向某次提交，而 SVN 分支是拷贝的目录。这个特性使 Git 的分支切换非常迅速，并且创建成本非常低。

---

# Git

Git 保存的不是文件差异或者变化量，而只是一系列文件快照（索引）。Git 中的分支，其实本质上仅仅是个指向 commit 对象的可变指针，切换分支就是改变指针指向的commit对象。

![bg right:40% 80%](https://image.ldbmcs.com/2021-06-06-Bys7se.jpg)

---

# 长期分支

1. 主分支Master：代码库应该有且仅有一个主分支。所有提供给用户使用的正式版本，都在这个主分支上发布。

2. 开发分支Develop：主分支只用来分布重大版本，日常开发应该在另一条分支上完成。我们把开发用的分支，叫做Develop。

---

# 临时分支

分支模型通常因团队而异，并常常是社区争论的主题之一。

---

## 1. Release branching & 预发布分支

分支创建自：develop；必须合并回：develop和master；分支命名约定：release-*。

预发布分支是指发布正式版本之前（即合并到Master分支之前），我们可能需要有一个预发布的版本进行测试。

预发布分支是从Dev分支上分出来的，预发布结束之后（即测试没有问题之后），必须合并进Dev和Master。

---

## 2. Feature branching & 功能分支

功能分支是为了开发某种特定功能，从Develop分支上面分出来的。开发完成后，要再并入Develop。

功能分支通常与功能切换（启用或禁用产品中的功能的切换）相结合，这使得在激活功能时可以轻松地把代码合并到主分支中。实验性的新功能开发分支，有可能会被砍的。

---

![bg 80%](https://image.ldbmcs.com/2021-06-07-FJbvON.jpg)

---

## 3. Task Branching & 任务分支

任务分支又被称之issue分支，issue 用于 Bug追踪和需求管理。建议先新建 Issue，再新建对应的任务分支。任务分支总是为了解决一个或多个 Issue。

任务分支的名称，可以与issue的名字保持一致，并且包含issue的编号。任务分支与敏捷开发相得益彰，每个story或者bug fix都存在于自己的分支中，可以很轻松的查看正在处理中的和已准备好发布的issue。

---

# XM项目

每个卡都在自己的分支上实现，并且分支名称都包含卡的编号。

![bg right 40%](https://image.ldbmcs.com/2021-06-06-1cglgW.png)

---

# 自动化测试

目前，大多数CI服务器可以对新分支进行测试，从而大大减少合并导致的”意外“的数量，有助于保持主代码的稳定。

---

<!-- _class: lead invert -->

# THANKS